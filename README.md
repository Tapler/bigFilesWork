# generateXML

Генератор XML-файлов реестра платежей с последующей упаковкой в zip и возможностью отправки base64-архива в API.

## Как использовать

### 1. Генерация XML-файлов и архива

Компилируйте и запускайте основной класс:

```
mvn compile
mvn exec:java -Dexec.mainClass=org.example.Main
```

- Будут созданы файлы `output_1.xml`, `output_2.xml`, ... и архив `result.zip`.
- Также будет создан файл `result.zip.base64` с base64-кодировкой архива.

### 2. Отправка архива в API

Для отправки base64-архива вызовите:

```
mvn exec:java -Dexec.mainClass=org.example.Main -Dexec.args="mainSendApi"
mvn exec:java -Dexec.mainClass=org.example.Main -Dexec.args="sendJsonBase64"
mvn exec:java -Dexec.mainClass=org.example.Main -Dexec.args="sendXmlBase64"
```

или вызовите метод `Main.mainSendApi()` через вашу IDE.

- Будет считан файл `result.zip.base64` и отправлен в API по адресу, указанному в коде.

Для отправки base64 XML-файла (result.base64) в API с параметром isUnzip=1 вызовите:

- Будет считан файл `result.base64` (base64-кодировка единственного XML-файла) и отправлен в API с параметром isUnzip=1.

---

**Важно:**
- Все файлы от предыдущего запуска автоматически очищаются перед новым запуском.
- Количество файлов (`fileCount`) и количество платежей в каждом файле (`paymentCount`) можно менять в Main.java.
- Для корректной работы отправки в API необходим доступ к внешнему сервису.

---

## Описание ключевых классов

### JsonSplitter
Потоково делит большой JSON-файл с массивом paymentRegistryItem на части по заданному количеству элементов (maxItems). Заголовок (корневые поля) сохраняется, а массив записей разбивается на отдельные файлы. Запуск через GUI: выбор файла и лимита.

### XmlToJsonJacksonStaxConverter
Конвертирует большой XML-файл с платежами в JSON с помощью потокового парсинга (StAX для XML и Jackson Streaming API для JSON). Не загружает весь файл в память, что позволяет обрабатывать большие файлы. Сохраняет основные атрибуты реестра и массив платежей.

### XmlToJsonJacksonStaxConverterWithApi
Аналогичен XmlToJsonJacksonStaxConverter, но поддерживает получение исходного XML не только из файла, но и по API (base64 через HTTP). Позволяет замерять время и память, а также сохранять промежуточные данные. Удобен для интеграции с внешними сервисами.

### GenerateBig

`GenerateBig` — отдельная утилита для генерации очень больших XML-файлов реестра платежей (например, с миллионами записей). 

- Позволяет задать количество файлов (сегментов) и количество платежей в каждом файле через константы в коде.
- Сначала вычисляет итоговую сумму всех платежей, затем формирует XML с этой суммой в заголовке.
- Генерирует файлы вида `output_big_<кол-во_платежей>_<номер_файла>.xml`.
- Удаляет старые выходные файлы перед запуском.
- Используется для тестирования производительности и работы с очень большими объемами данных.

Запуск:
```
mvn compile
mvn exec:java -Dexec.mainClass=org.example.GenerateBig
```
